import os
import time
from TwitterFollowBot import TwitterBot


class HocknasBot(object):

    def __init__(self, source_file_name,
                 index_file_name, ):
        self.source_file_name = source_file_name
        self.index_file_name = index_file_name

    def _get_current_index(self):
        if not(os.path.isfile(self.index_file_name)):
            return 0
        with open(self.index_file_name) as index_fh:
            return int(index_fh.read().strip())

    def _increment_index(self, index):
        with open(self.index_file_name, "w") as index_fh:
            index_fh.truncate()
            index_fh.write("%d" % (index + 1))
            index_fh.close()

    def _get_current_line(self, index):
        with open(self.source_file_name) as source_fh:
            # read the desired line
            for i, status_str in enumerate(source_fh):
                if i == index:
                    break
            return status_str.strip()

    def wait_on_action(self):

        wait_time = 0
        print( "\n ==>> Waiting %d seconds before action \n" % wait_time)
        time.sleep(wait_time)

        return wait_time


    def post(self):


        # Linea que va a twittear
        index = self._get_current_index()

        # MANUAL
        # tweet = int(input("What line do you want to tweet? : "))-1

        # PHRASE (rt, follow x3)
        # phrase = str(input("What phrase do you want to use? : "))

        # AUTO
        # Numero de bots que se usarán
        count = 173+1

        # MANUAL
        # count = int(input("How many accounts there are available? :"))

        # NUMB (rt , follow x3)
        # numb = str(input("How many do you want repeat this function per account? : "))

        # Se inicializa un array que contendrá los nombres de los archivos de configuracion para cada bot
        text = []

        # Patrones con la secuencia de ejecución de cada API

        serial1 = [62, 52, 111, 161, 168, 162, 75, 76, 150, 102, 48, 164, 67, 40, 153, 93, 108, 143, 43, 39, 163, 133, 42, 136,
         131, 156, 126, 101, 105, 23, 18, 26, 63, 122, 9, 65, 92, 118, 8, 14, 123, 125, 117, 69, 58, 114, 134, 11, 120,
         56, 66, 84, 78, 173, 94, 109, 88, 89, 90, 24, 3, 45, 104, 12, 57, 155, 61, 73, 60, 34, 160, 87, 59, 74, 103,
         152, 79, 135, 47, 96, 128, 33, 116, 2, 119, 145, 10, 124, 44, 30, 17, 36, 41, 25, 138, 19, 50, 13, 77, 4, 15,
         144, 80, 99, 158, 115, 113, 86, 141, 29, 121, 46, 32, 147, 154, 140, 85, 146, 6, 166, 35, 27, 49, 172, 51, 148,
         37, 169, 151, 38, 5, 100, 82, 149, 16, 81, 1, 31, 142, 95, 157, 106, 91, 159, 129, 20, 55, 21, 71, 22, 7, 53,
         139, 54, 68, 170, 112, 130, 167, 127, 97, 165, 137, 70, 28, 107, 72, 171, 64, 132, 110, 83, 98]

        serial2 = [7, 55, 81, 103, 151, 13, 36, 104, 39, 42, 114, 16, 155, 152, 68, 69, 10, 136, 78, 160, 149, 141, 153, 117, 29,
         14, 163, 64, 73, 45, 17, 101, 23, 165, 143, 95, 107, 97, 52, 110, 5, 24, 67, 28, 159, 34, 170, 150, 44, 35, 58,
         86, 83, 37, 70, 2, 162, 59, 123, 138, 122, 33, 61, 164, 99, 167, 88, 50, 26, 60, 133, 172, 96, 98, 18, 82, 63,
         8, 109, 142, 6, 40, 48, 75, 128, 102, 111, 41, 85, 30, 38, 158, 1, 27, 120, 90, 161, 84, 51, 74, 106, 77, 12,
         31, 32, 9, 22, 119, 4, 118, 65, 53, 47, 100, 79, 126, 171, 113, 62, 46, 131, 87, 173, 92, 168, 89, 125, 93, 72,
         140, 54, 71, 137, 11, 139, 166, 76, 156, 3, 157, 144, 129, 108, 43, 130, 19, 154, 66, 91, 105, 112, 80, 57,
         132, 148, 21, 124, 49, 121, 56, 147, 146, 20, 135, 25, 15, 127, 134, 169, 115, 116, 145, 94]

        serial3 = [19, 172, 148, 22, 30, 20, 131, 66, 135, 118, 3, 101, 46, 140, 164, 33, 77, 13, 83, 86, 121, 119, 38, 157, 36,
         151, 93, 116, 128, 2, 162, 34, 6, 107, 61, 143, 96, 168, 47, 92, 158, 64, 21, 44, 106, 35, 56, 62, 59, 75, 32,
         156, 109, 45, 7, 12, 8, 50, 51, 137, 26, 49, 169, 14, 171, 78, 57, 155, 161, 112, 37, 82, 23, 72, 28, 105, 88,
         142, 91, 54, 111, 145, 154, 97, 99, 122, 68, 146, 42, 138, 25, 76, 108, 84, 11, 16, 163, 53, 103, 170, 69, 87,
         166, 98, 4, 89, 104, 58, 43, 134, 5, 123, 79, 126, 167, 60, 17, 149, 29, 139, 39, 165, 41, 115, 132, 150, 73,
         71, 124, 1, 114, 127, 18, 173, 113, 125, 55, 153, 136, 52, 65, 95, 15, 144, 159, 80, 130, 85, 31, 48, 110, 141,
         147, 63, 81, 160, 117, 10, 24, 40, 102, 129, 74, 90, 70, 100, 67, 9, 120, 152, 94, 133, 27]

        serial4 = [23, 5, 112, 84, 145, 164, 122, 93, 123, 101, 106, 19, 104, 169, 97, 140, 33, 26, 58, 128, 90, 66, 35, 77, 160,
         53, 91, 20, 69, 109, 12, 162, 22, 62, 45, 167, 138, 16, 61, 86, 165, 79, 153, 134, 127, 172, 98, 54, 121, 149,
         157, 135, 25, 132, 1, 85, 159, 31, 75, 88, 92, 117, 105, 47, 13, 116, 27, 18, 119, 7, 152, 141, 166, 3, 78, 81,
         113, 43, 74, 17, 71, 72, 131, 41, 39, 6, 2, 48, 151, 52, 14, 148, 155, 76, 133, 65, 142, 70, 103, 64, 38, 4,
         111, 94, 21, 115, 49, 30, 89, 46, 118, 120, 57, 73, 36, 28, 63, 40, 67, 87, 147, 170, 108, 83, 55, 56, 139, 24,
         125, 9, 137, 42, 144, 37, 34, 173, 32, 130, 143, 158, 29, 99, 96, 100, 11, 168, 161, 129, 95, 146, 44, 60, 114,
         126, 8, 59, 154, 80, 68, 171, 107, 51, 15, 110, 102, 136, 82, 156, 50, 163, 150, 10, 124]

        serial5 = [55, 137, 153, 30, 72, 84, 129, 149, 69, 20, 166, 97, 10, 77, 164, 131, 156, 37, 38, 53, 113, 4, 57, 172, 111,
         76, 104, 124, 158, 2, 43, 92, 118, 127, 31, 106, 87, 12, 17, 19, 107, 52, 56, 9, 154, 33, 134, 11, 165, 18,
         159, 47, 58, 85, 40, 80, 161, 91, 86, 98, 125, 142, 138, 46, 36, 163, 35, 70, 167, 83, 64, 22, 42, 144, 79,
         119, 68, 109, 39, 23, 81, 21, 89, 74, 115, 13, 141, 27, 1, 7, 122, 45, 168, 29, 60, 120, 14, 170, 121, 73, 95,
         34, 126, 26, 100, 24, 75, 117, 143, 151, 108, 123, 150, 105, 157, 25, 173, 6, 96, 102, 128, 44, 103, 28, 140,
         114, 139, 41, 66, 65, 82, 133, 148, 145, 88, 67, 110, 50, 116, 62, 146, 130, 101, 15, 99, 5, 78, 94, 48, 90,
         155, 63, 8, 59, 54, 136, 162, 49, 16, 160, 51, 61, 32, 112, 147, 169, 171, 135, 71, 152, 3, 93, 132]

        serial6 = [102, 93, 3, 12, 141, 15, 51, 56, 94, 17, 156, 164, 168, 5, 37, 100, 147, 10, 46, 28, 110, 122, 173, 148, 84,
         101, 58, 61, 105, 60, 45, 138, 76, 27, 34, 133, 2, 22, 7, 26, 152, 63, 82, 52, 126, 159, 134, 172, 68, 35, 144,
         88, 78, 36, 80, 62, 55, 44, 124, 107, 13, 16, 24, 106, 20, 162, 121, 54, 11, 92, 83, 149, 81, 136, 170, 111,
         49, 75, 157, 108, 150, 115, 25, 65, 120, 23, 21, 165, 139, 109, 6, 103, 31, 143, 9, 48, 50, 38, 132, 40, 163,
         19, 128, 116, 29, 89, 14, 117, 167, 140, 69, 169, 91, 86, 97, 70, 158, 18, 161, 85, 8, 47, 145, 64, 39, 127,
         77, 41, 123, 96, 142, 32, 73, 160, 130, 125, 43, 154, 30, 1, 153, 87, 98, 53, 72, 135, 166, 71, 171, 59, 137,
         66, 79, 113, 131, 95, 4, 74, 57, 146, 33, 118, 112, 129, 151, 99, 119, 155, 67, 90, 42, 114, 104]

        serial7 = [43, 47, 126, 149, 53, 141, 2, 41, 96, 10, 108, 112, 116, 49, 1, 136, 83, 143, 32, 101, 91, 22, 40, 70, 9, 64,
         80, 148, 89, 107, 57, 166, 154, 45, 35, 160, 27, 87, 163, 14, 146, 60, 36, 39, 16, 161, 6, 164, 11, 131, 144,
         79, 73, 21, 120, 69, 137, 24, 78, 168, 170, 46, 100, 34, 86, 84, 90, 133, 130, 7, 145, 104, 93, 134, 99, 135,
         63, 122, 77, 157, 153, 23, 52, 109, 51, 31, 58, 25, 159, 97, 152, 65, 138, 18, 98, 85, 128, 113, 115, 92, 61,
         48, 38, 4, 81, 72, 82, 95, 5, 76, 165, 167, 12, 17, 142, 121, 102, 125, 155, 147, 110, 42, 59, 62, 151, 26,
         103, 139, 15, 129, 74, 66, 117, 19, 105, 56, 127, 111, 28, 29, 106, 88, 3, 50, 123, 172, 8, 75, 13, 67, 119,
         37, 71, 44, 132, 124, 54, 114, 55, 68, 158, 171, 156, 118, 162, 33, 173, 140, 94, 30, 150, 20, 169]

        serial8 = [84, 117, 119, 132, 148, 52, 17, 105, 46, 8, 167, 68, 4, 115, 24, 125, 94, 89, 83, 127, 151, 126, 39, 171, 13,
         42, 135, 3, 70, 134, 23, 63, 18, 32, 2, 80, 14, 173, 65, 58, 158, 157, 35, 50, 78, 123, 27, 149, 150, 48, 154,
         79, 26, 21, 124, 121, 43, 54, 7, 153, 142, 49, 41, 163, 30, 5, 91, 166, 73, 29, 93, 86, 11, 82, 15, 72, 112,
         90, 45, 77, 107, 1, 120, 156, 75, 6, 64, 122, 69, 85, 66, 128, 102, 103, 62, 165, 136, 162, 138, 147, 25, 109,
         37, 81, 96, 20, 145, 140, 104, 92, 114, 31, 40, 98, 131, 76, 12, 87, 130, 19, 111, 152, 169, 106, 38, 60, 55,
         139, 170, 28, 155, 133, 116, 100, 61, 88, 97, 10, 164, 51, 71, 159, 118, 101, 110, 141, 172, 168, 53, 16, 67,
         99, 143, 34, 57, 160, 161, 137, 144, 74, 47, 44, 36, 9, 146, 108, 56, 33, 59, 22, 129, 95, 113]

        serial9 = [49, 10, 68, 150, 141, 84, 41, 55, 37, 57, 164, 136, 153, 76, 157, 132, 60, 103, 32, 166, 83, 158, 148, 78, 39,
         161, 135, 146, 63, 118, 143, 14, 126, 137, 19, 140, 3, 120, 31, 26, 13, 114, 5, 35, 87, 43, 139, 172, 113, 20,
         50, 74, 134, 75, 96, 90, 36, 151, 81, 94, 82, 92, 133, 121, 46, 101, 117, 93, 44, 128, 170, 127, 160, 64, 124,
         159, 142, 9, 131, 16, 162, 15, 155, 108, 69, 97, 99, 23, 115, 109, 152, 17, 11, 33, 129, 79, 70, 72, 71, 138,
         52, 22, 154, 80, 18, 119, 125, 38, 104, 168, 67, 24, 88, 123, 27, 106, 89, 110, 149, 100, 21, 53, 48, 28, 30,
         73, 111, 54, 130, 116, 51, 34, 47, 4, 156, 62, 12, 105, 163, 61, 144, 86, 102, 169, 107, 65, 56, 147, 66,
         145, 7, 95, 112, 45, 6, 165, 42, 2, 40, 85, 122, 167, 25, 91, 98, 1, 77, 29, 171, 8, 58, 59]

        seial10 = [124, 79, 90, 70, 101, 7, 157, 81, 94, 21, 159, 23, 97, 35, 112, 22, 154, 15, 30, 169, 140, 152, 58, 133, 3, 17,
         162, 132, 18, 141, 156, 155, 50, 36, 135, 144, 168, 6, 13, 46, 12, 38, 89, 37, 164, 39, 80, 72, 76, 107, 87,
         120, 137, 123, 150, 172, 85, 127, 62, 122, 146, 86, 138, 83, 95, 65, 54, 78, 113, 25, 10, 5, 4, 60, 153, 125,
         91, 117, 61, 134, 128, 116, 52, 88, 64, 51, 19, 110, 106, 126, 121, 104, 167, 16, 42, 163, 48, 41, 53, 118,
         129, 28, 49, 20, 47, 149, 11, 43, 151, 82, 31, 69, 24, 40, 66, 45, 33, 115, 111, 63, 171, 170, 99, 158, 27,
         139, 44, 102, 130, 142, 84, 56, 160, 136, 75, 119, 147, 98, 57, 9, 55, 161, 29, 34, 92, 32, 68, 105, 166, 77,
         103, 59, 131, 14, 114, 8, 108, 165, 148, 145, 100, 26, 2, 74, 143, 93, 71, 67, 109, 1, 96, 73]

        serial11 = [165, 108, 96, 132, 95, 59, 60, 138, 1, 48, 20, 150, 130, 41, 47, 17, 144, 54, 154, 142, 56, 21, 139, 103, 122,
         160, 34, 136, 137, 67, 18, 71, 84, 157, 166, 46, 163, 2, 27, 76, 98, 134, 115, 141, 121, 29, 156, 25, 63, 37,
         70, 129, 87, 116, 64, 19, 106, 133, 131, 36, 86, 114, 128, 93, 38, 125, 24, 102, 117, 79, 33, 152, 110, 4, 3,
         104, 31, 140, 78, 170, 11, 10, 107, 13, 153, 113, 15, 81, 45, 26, 68, 123, 89, 120, 83, 55, 58, 164, 23, 69,
         14, 169, 90, 162, 92, 62, 77, 100, 28, 39, 118, 158, 171, 75, 53, 172, 12, 80, 105, 111, 124, 52, 151, 94, 6,
         147, 44, 167, 73, 159, 119, 127, 32, 49, 146, 42, 30, 109, 57, 43, 99, 7, 82, 50, 8, 51, 88, 5, 40, 35,
         22, 168, 149, 148, 135, 65, 9, 74, 161, 85, 143, 61, 72, 145, 91, 155, 101, 97, 112, 66, 126, 16]

        # Secuencia mediante la cual se agregan al Arraylist los nombres de los archivos de configuracion para cada bot
        for i in range(-1, count):
            try:
            # Normal - Without format
            # text.append("0_script/conf_" + str(i) + ".txt")

            # API 1
             text.append("1_script/conf_" + str(serial1[i]) + ".txt")

            # API 2
            # text.append("2_script/conf_" + str(serial2[i]) + ".txt")

            # API 3
            # text.append("3_script/conf_" + str(serial3[i]) + ".txt")

            # API 4
            # text.append("4_script/conf_" + str(serial4[i]) + ".txt")

            # API 5
            # text.append("5_script/conf_" + str(serial5[i]) + ".txt")

            # API 6
            # text.append("6_script/conf_" + str(serial6[i]) + ".txt")

            # API 7
            # text.append("7_script/conf_" + str(serial7[i]) + ".txt")

            # API 8
            # text.append("8_script/conf_" + str(serial8[i]) + ".txt")

            # API 9
            # text.append("9_script/conf_" + str(serial9[i]) + ".txt")

            # API 10
            # text.append("10_script/conf_" + str(serial10[i]) + ".txt")

            # API 11
            # text.append("11_script/conf_" + str(serial11[i]) + ".txt")

            except:
                print("El directorio ha sido mal configurado\n")
                break

        for h in range(1, count):
            try:
            # AUTO
             status_str = self._get_current_line(index)

            # MANUAL
            # status_str = self._get_current_line(tweet)

            # BOT
            # Se declaran todas las configuraciones
            # hck_bot = TwitterBot(text[h])

            # FUNCIONES DEL BOT

            # hck_bot.auto_rt(phrase, count = numb)
            # hck_bot.auto_follow( phrase , count = numb )
            # hck_bot.auto_follow_followers_of_user( phrase , count = numb )

            # hck_bot.auto_follow_followers( )
            # hck_bot.auto_unfollow_nonfollowers( )
            # hck_bot.auto_unfollow_all_followers( )

            # hck_bot.sync_follows()
            # hck_bot.send_tweet(status_str)
            except:
                print("Ha ocurrido un error al realizar la operación solicitada.\n")
                try:
                    hck_bot+=1
                    print("Intentando con el perfil siguiente")
                except:
                    print("ERROR: IMPOSIBLE CONTINUAR")
                    break
                else:
                    continue

            else:
            # VALORES QUE SALDRAN PANTALLA
             print("-------------------------------------- \n Account %d of %d " %(h, count-1))

             print("\t" + text[h])
             print("\t" + status_str )

            # Incrementar el index por ejecucion
             self._increment_index(index)

            # Temporizador
             self.wait_on_action()



def _csv_to_float_list(csv):
    return list(map(float, csv.split(',')))


if __name__ == '__main__':

    def _get_comma_separated_args(option, opt, value, parser):
        setattr(parser.values, option.dest, _csv_to_float_list(value))

    from optparse import OptionParser
    parser = OptionParser()

    parser.add_option('--source_file', dest='source_file',
                      default="tweet_list.txt",
                      help="source file (one line per tweet)")

    parser.add_option('--index_file', dest='index_file',
                      default="index",
                      help="index file (must be able to write to this file)")

    (options, args) = parser.parse_args()

    bot = HocknasBot(options.source_file, options.index_file,)

    bot.post()
